The core functionality is working, but I want to change some behaviors.

I will provide:
- A brief description of the current behavior and workflow
- A description of the new behavior/workflow I want
- The relevant code sections

Please:
1. Restate, in your own words, the current behavior and the desired new behavior.
2. Propose a minimal set of code changes to achieve this, focusing on modifying existing functions rather than rewriting everything.
3. Show only the functions or sections that need to change, clearly indicating old vs new versions.
4. Point out any risks or side effects and suggest quick tests to verify correctness.

Current behavior:
[DESCRIBE]

Desired new behavior:
[DESCRIBE]

Relevant code:
[PASTE ONLY THE FUNCTIONS / SECTIONS INVOLVED]
