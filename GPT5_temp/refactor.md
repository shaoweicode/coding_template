The code is working, but it has become messy and hard for me to understand.

I want to refactor it for clarity and better structure, WITHOUT changing behavior.

I will provide:
- The current file or module
- A short description of what this module is supposed to do
- Any specific problems I see (e.g., long functions, duplicated code, confusing naming)

Please:
1. Analyze the current code and identify structural problems and code smells.
2. Propose a refactored version with:
   - Clear function and variable names
   - Shorter, more focused functions
   - Comments and docstrings explaining each main part
   - If appropriate, splitting into smaller helper functions or classes
3. Confirm what tests or example runs I should execute to verify that behavior did not change.
4. Keep the code at a level a non-professional can still follow.

Module description:
[DESCRIBE]

Current code:
[PASTE THE FILE OR RELEVANT PARTS]

Problems I notice:
[YOUR NOTES]
